"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
exports.__esModule = true;
jest.mock('../window');
var react_1 = __importDefault(require("react"));
var react_dom_1 = __importDefault(require("react-dom"));
var test_utils_1 = __importDefault(require("react-dom/test-utils"));
var Video_1 = __importDefault(require("./Video"));
var window_1 = require("../window");
var constants_1 = require("../constants");
describe('components/Video', function () {
    var play = jest.fn();
    var VideoWrapper = /** @class */ (function (_super) {
        __extends(VideoWrapper, _super);
        function VideoWrapper() {
            var _this = _super !== null && _super.apply(this, arguments) || this;
            _this.ref = react_1["default"].createRef();
            _this.state = {
                stream: null
            };
            return _this;
        }
        VideoWrapper.prototype.render = function () {
            return react_1["default"].createElement(Video_1["default"], { ref: this.ref, stream: this.state.stream || this.props.stream, onMinimizeToggle: this.props.onMinimizeToggle, play: this.props.play, userId: "test", muted: this.props.muted, mirrored: this.props.mirrored, nickname: this.props.nickname, onChangeNickname: this.props.onChangeNickname, windowState: this.props.windowState });
        };
        return VideoWrapper;
    }(react_1["default"].PureComponent));
    var component;
    var video;
    var onMinimizeToggle;
    var onChangeNickname;
    var mediaStream;
    var url;
    var wrapper;
    var nickname;
    var defaultFlags = {
        muted: false,
        mirrored: false,
        windowState: undefined
    };
    function render(args) {
        return __awaiter(this, void 0, void 0, function () {
            var flags, div;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        nickname = 'john';
                        flags = Object.assign({}, defaultFlags, args);
                        onMinimizeToggle = jest.fn();
                        onChangeNickname = jest.fn();
                        mediaStream = new window_1.MediaStream();
                        div = document.createElement('div');
                        return [4 /*yield*/, new Promise(function (resolve) {
                                var stream = {
                                    stream: mediaStream,
                                    url: url,
                                    type: constants_1.STREAM_TYPE_CAMERA
                                };
                                react_dom_1["default"].render(react_1["default"].createElement(VideoWrapper, { ref: function (instance) { return resolve(instance); }, stream: stream, play: play, userId: "test", muted: flags.muted, mirrored: flags.mirrored, onChangeNickname: onChangeNickname, onMinimizeToggle: onMinimizeToggle, nickname: nickname, windowState: flags.windowState }), div);
                            })];
                    case 1:
                        component = _a.sent();
                        video = test_utils_1["default"].findRenderedComponentWithType(component, Video_1["default"]);
                        wrapper = div.children[0];
                        return [2 /*return*/];
                }
            });
        });
    }
    describe('render', function () {
        it('should not fail', function () { return __awaiter(void 0, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, render()];
                    case 1:
                        _a.sent();
                        return [2 /*return*/];
                }
            });
        }); });
        it('Mirrored and widnowState propogate to rendered classes', function () { return __awaiter(void 0, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, render({ mirrored: true })];
                    case 1:
                        _a.sent();
                        expect(wrapper.className).toBe('video-container mirrored');
                        return [2 /*return*/];
                }
            });
        }); });
        it('Mirrored and windowState propogate to rendered classes', function () { return __awaiter(void 0, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, render({ mirrored: true, windowState: 'minimized' })];
                    case 1:
                        _a.sent();
                        expect(wrapper.className).toBe('video-container minimized mirrored');
                        return [2 /*return*/];
                }
            });
        }); });
    });
    describe('componentDidUpdate', function () {
        describe('src', function () {
            beforeEach(function () { return __awaiter(void 0, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4 /*yield*/, render()];
                        case 1:
                            _a.sent();
                            delete video.videoRef.current.srcObject;
                            return [2 /*return*/];
                    }
                });
            }); });
            it('updates src only when changed', function () {
                mediaStream = new window_1.MediaStream();
                component.setState({
                    stream: {
                        url: 'test',
                        stream: mediaStream,
                        type: constants_1.STREAM_TYPE_CAMERA
                    }
                });
                expect(video.videoRef.current.src).toBe('http://localhost/test');
                component.setState({
                    stream: {
                        url: 'test',
                        stream: mediaStream,
                        type: constants_1.STREAM_TYPE_CAMERA
                    }
                });
            });
            it('updates srcObject only when changed', function () {
                video.videoRef.current.srcObject = null;
                mediaStream = new window_1.MediaStream();
                component.setState({
                    stream: {
                        url: 'test',
                        stream: mediaStream,
                        type: constants_1.STREAM_TYPE_CAMERA
                    }
                });
                expect(video.videoRef.current.srcObject).toBe(mediaStream);
                component.setState({
                    stream: {
                        url: 'test',
                        stream: mediaStream,
                        type: constants_1.STREAM_TYPE_CAMERA
                    }
                });
            });
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVmlkZW8udGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jbGllbnQvY29tcG9uZW50cy9WaWRlby50ZXN0LnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFBO0FBQ3RCLGdEQUF5QjtBQUN6Qix3REFBZ0M7QUFDaEMsb0VBQTRDO0FBQzVDLGtEQUEyQztBQUMzQyxvQ0FBdUM7QUFDdkMsMENBQWlEO0FBTWpELFFBQVEsQ0FBQyxrQkFBa0IsRUFBRTtJQU0zQixJQUFNLElBQUksR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUE7SUFFdEI7UUFBMkIsZ0NBQTJDO1FBQXRFO1lBQUEscUVBcUJDO1lBcEJDLFNBQUcsR0FBRyxrQkFBSyxDQUFDLFNBQVMsRUFBUyxDQUFBO1lBRTlCLFdBQUssR0FBRztnQkFDTixNQUFNLEVBQUUsSUFBSTthQUNiLENBQUE7O1FBZ0JILENBQUM7UUFkQyw2QkFBTSxHQUFOO1lBQ0UsT0FBTyxpQ0FBQyxrQkFBSyxJQUNYLEdBQUcsRUFBRSxJQUFJLENBQUMsR0FBRyxFQUNiLE1BQU0sRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFDOUMsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsRUFDN0MsSUFBSSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUNyQixNQUFNLEVBQUMsTUFBTSxFQUNiLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssRUFDdkIsUUFBUSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUM3QixRQUFRLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQzdCLGdCQUFnQixF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QUFRLENBQUM7b0JBQ2pCLE1BQU0sRUFBRTt3QkFDTixHQUFHLEVBQUUsTUFBTTt3QkFDWCxNQUFNLEVBQUUsV0FBVzt3QkFDbkIsSUFBSSxFQUFFLDhCQUFrQjtxQkFDekI7aUJBQ0YsQ0FBQyxDQUFBO2dCQUNGLE1BQU0sQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLE9BQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUE7Z0JBQzNELFNBQVMsQ0FBQyxRQUFRLENBQUM7b0JBQ2pCLE1BQU0sRUFBRTt3QkFDTixHQUFHLEVBQUUsTUFBTTt3QkFDWCxNQUFNLEVBQUUsV0FBVzt3QkFDbkIsSUFBSSxFQUFFLDhCQUFrQjtxQkFDekI7aUJBQ0YsQ0FBQyxDQUFBO1lBQ0osQ0FBQyxDQUFDLENBQUE7UUFDSixDQUFDLENBQUMsQ0FBQTtJQUNKLENBQUMsQ0FBQyxDQUFBO0FBRUosQ0FBQyxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJqZXN0Lm1vY2soJy4uL3dpbmRvdycpXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnXG5pbXBvcnQgUmVhY3RET00gZnJvbSAncmVhY3QtZG9tJ1xuaW1wb3J0IFRlc3RVdGlscyBmcm9tICdyZWFjdC1kb20vdGVzdC11dGlscydcbmltcG9ydCBWaWRlbywgeyBWaWRlb1Byb3BzIH0gZnJvbSAnLi9WaWRlbydcbmltcG9ydCB7IE1lZGlhU3RyZWFtIH0gZnJvbSAnLi4vd2luZG93J1xuaW1wb3J0IHsgU1RSRUFNX1RZUEVfQ0FNRVJBIH0gZnJvbSAnLi4vY29uc3RhbnRzJ1xuaW1wb3J0IHsgU3RyZWFtV2l0aFVSTCB9IGZyb20gJy4uL3JlZHVjZXJzL3N0cmVhbXMnXG5pbXBvcnQgeyBOaWNrbmFtZU1lc3NhZ2UgfSBmcm9tICcuLi9hY3Rpb25zL1BlZXJBY3Rpb25zJ1xuaW1wb3J0IHsgV2luZG93U3RhdGUgfSBmcm9tICcuLi9yZWR1Y2Vycy93aW5kb3dTdGF0ZXMnXG5pbXBvcnQgeyBNaW5pbWl6ZVRvZ2dsZVBheWxvYWQgfSBmcm9tICcuLi9hY3Rpb25zL1N0cmVhbUFjdGlvbnMnXG5cbmRlc2NyaWJlKCdjb21wb25lbnRzL1ZpZGVvJywgKCkgPT4ge1xuXG4gIGludGVyZmFjZSBWaWRlb1N0YXRlIHtcbiAgICBzdHJlYW06IG51bGwgfCBTdHJlYW1XaXRoVVJMXG4gIH1cblxuICBjb25zdCBwbGF5ID0gamVzdC5mbigpXG5cbiAgY2xhc3MgVmlkZW9XcmFwcGVyIGV4dGVuZHMgUmVhY3QuUHVyZUNvbXBvbmVudDxWaWRlb1Byb3BzLCBWaWRlb1N0YXRlPiB7XG4gICAgcmVmID0gUmVhY3QuY3JlYXRlUmVmPFZpZGVvPigpXG5cbiAgICBzdGF0ZSA9IHtcbiAgICAgIHN0cmVhbTogbnVsbCxcbiAgICB9XG5cbiAgICByZW5kZXIgKCkge1xuICAgICAgcmV0dXJuIDxWaWRlb1xuICAgICAgICByZWY9e3RoaXMucmVmfVxuICAgICAgICBzdHJlYW09e3RoaXMuc3RhdGUuc3RyZWFtIHx8IHRoaXMucHJvcHMuc3RyZWFtfVxuICAgICAgICBvbk1pbmltaXplVG9nZ2xlPXt0aGlzLnByb3BzLm9uTWluaW1pemVUb2dnbGV9XG4gICAgICAgIHBsYXk9e3RoaXMucHJvcHMucGxheX1cbiAgICAgICAgdXNlcklkPVwidGVzdFwiXG4gICAgICAgIG11dGVkPXt0aGlzLnByb3BzLm11dGVkfVxuICAgICAgICBtaXJyb3JlZD17dGhpcy5wcm9wcy5taXJyb3JlZH1cbiAgICAgICAgbmlja25hbWU9e3RoaXMucHJvcHMubmlja25hbWV9XG4gICAgICAgIG9uQ2hhbmdlTmlja25hbWU9e3RoaXMucHJvcHMub25DaGFuZ2VOaWNrbmFtZX1cbiAgICAgICAgd2luZG93U3RhdGU9e3RoaXMucHJvcHMud2luZG93U3RhdGV9XG4gICAgICAvPlxuICAgIH1cbiAgfVxuXG4gIGxldCBjb21wb25lbnQ6IFZpZGVvV3JhcHBlclxuICBsZXQgdmlkZW86IFZpZGVvXG4gIGxldCBvbk1pbmltaXplVG9nZ2xlOlxuICAgIGplc3QuTW9ja2VkRnVuY3Rpb248KHBheWxvYWQ6IE1pbmltaXplVG9nZ2xlUGF5bG9hZCkgPT4gdm9pZD5cbiAgbGV0IG9uQ2hhbmdlTmlja25hbWU6IGplc3QuTW9ja2VkRnVuY3Rpb248KG1lc3NhZ2U6IE5pY2tuYW1lTWVzc2FnZSkgPT4gdm9pZD5cbiAgbGV0IG1lZGlhU3RyZWFtOiBNZWRpYVN0cmVhbVxuICBsZXQgdXJsOiBzdHJpbmdcbiAgbGV0IHdyYXBwZXI6IEVsZW1lbnRcbiAgbGV0IG5pY2tuYW1lOiBzdHJpbmdcblxuICBpbnRlcmZhY2UgRmxhZ3Mge1xuICAgIG11dGVkOiBib29sZWFuXG4gICAgbWlycm9yZWQ6IGJvb2xlYW5cbiAgICB3aW5kb3dTdGF0ZTogV2luZG93U3RhdGVcbiAgfVxuICBjb25zdCBkZWZhdWx0RmxhZ3M6IEZsYWdzID0ge1xuICAgIG11dGVkOiBmYWxzZSxcbiAgICBtaXJyb3JlZDogZmFsc2UsXG4gICAgd2luZG93U3RhdGU6IHVuZGVmaW5lZCxcbiAgfVxuICBhc3luYyBmdW5jdGlvbiByZW5kZXIgKGFyZ3M/OiBQYXJ0aWFsPEZsYWdzPikge1xuICAgIG5pY2tuYW1lID0gJ2pvaG4nXG4gICAgY29uc3QgZmxhZ3M6IEZsYWdzID0gT2JqZWN0LmFzc2lnbih7fSwgZGVmYXVsdEZsYWdzLCBhcmdzKVxuICAgIG9uTWluaW1pemVUb2dnbGUgPSBqZXN0LmZuKClcbiAgICBvbkNoYW5nZU5pY2tuYW1lID0gamVzdC5mbigpXG4gICAgbWVkaWFTdHJlYW0gPSBuZXcgTWVkaWFTdHJlYW0oKVxuICAgIGNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXG4gICAgY29tcG9uZW50ID0gYXdhaXQgbmV3IFByb21pc2U8VmlkZW9XcmFwcGVyPihyZXNvbHZlID0+IHtcbiAgICAgIGNvbnN0IHN0cmVhbTogU3RyZWFtV2l0aFVSTCA9IHtcbiAgICAgICAgc3RyZWFtOiBtZWRpYVN0cmVhbSxcbiAgICAgICAgdXJsLFxuICAgICAgICB0eXBlOiBTVFJFQU1fVFlQRV9DQU1FUkEsXG4gICAgICB9XG4gICAgICBSZWFjdERPTS5yZW5kZXIoXG4gICAgICAgIDxWaWRlb1dyYXBwZXJcbiAgICAgICAgICByZWY9e2luc3RhbmNlID0+IHJlc29sdmUoaW5zdGFuY2UhKX1cbiAgICAgICAgICBzdHJlYW09e3N0cmVhbX1cbiAgICAgICAgICBwbGF5PXtwbGF5fVxuICAgICAgICAgIHVzZXJJZD1cInRlc3RcIlxuICAgICAgICAgIG11dGVkPXtmbGFncy5tdXRlZH1cbiAgICAgICAgICBtaXJyb3JlZD17ZmxhZ3MubWlycm9yZWR9XG4gICAgICAgICAgb25DaGFuZ2VOaWNrbmFtZT17b25DaGFuZ2VOaWNrbmFtZX1cbiAgICAgICAgICBvbk1pbmltaXplVG9nZ2xlPXtvbk1pbmltaXplVG9nZ2xlfVxuICAgICAgICAgIG5pY2tuYW1lPXtuaWNrbmFtZX1cbiAgICAgICAgICB3aW5kb3dTdGF0ZT17ZmxhZ3Mud2luZG93U3RhdGV9XG4gICAgICAgIC8+LFxuICAgICAgICBkaXYsXG4gICAgICApXG4gICAgfSlcbiAgICB2aWRlbyA9IFRlc3RVdGlscy5maW5kUmVuZGVyZWRDb21wb25lbnRXaXRoVHlwZShjb21wb25lbnQsIFZpZGVvKVxuICAgIHdyYXBwZXIgPSBkaXYuY2hpbGRyZW5bMF1cbiAgfVxuXG4gIGRlc2NyaWJlKCdyZW5kZXInLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBub3QgZmFpbCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IHJlbmRlcigpXG4gICAgfSlcblxuICAgIGl0KCdNaXJyb3JlZCBhbmQgd2lkbm93U3RhdGUgcHJvcG9nYXRlIHRvIHJlbmRlcmVkIGNsYXNzZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCByZW5kZXIoeyBtaXJyb3JlZDogdHJ1ZSB9KVxuICAgICAgZXhwZWN0KHdyYXBwZXIuY2xhc3NOYW1lKS50b0JlKCd2aWRlby1jb250YWluZXIgbWlycm9yZWQnKVxuICAgIH0pXG5cbiAgICBpdCgnTWlycm9yZWQgYW5kIHdpbmRvd1N0YXRlIHByb3BvZ2F0ZSB0byByZW5kZXJlZCBjbGFzc2VzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgcmVuZGVyKHsgbWlycm9yZWQ6IHRydWUsIHdpbmRvd1N0YXRlOiAnbWluaW1pemVkJyB9KVxuICAgICAgZXhwZWN0KHdyYXBwZXIuY2xhc3NOYW1lKS50b0JlKCd2aWRlby1jb250YWluZXIgbWluaW1pemVkIG1pcnJvcmVkJylcbiAgICB9KVxuICB9KVxuXG4gIGRlc2NyaWJlKCdjb21wb25lbnREaWRVcGRhdGUnLCAoKSA9PiB7XG4gICAgZGVzY3JpYmUoJ3NyYycsICgpID0+IHtcbiAgICAgIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgICAgICBhd2FpdCByZW5kZXIoKVxuICAgICAgICBkZWxldGUgdmlkZW8udmlkZW9SZWYuY3VycmVudCEuc3JjT2JqZWN0XG4gICAgICB9KVxuICAgICAgaXQoJ3VwZGF0ZXMgc3JjIG9ubHkgd2hlbiBjaGFuZ2VkJywgKCkgPT4ge1xuICAgICAgICBtZWRpYVN0cmVhbSA9IG5ldyBNZWRpYVN0cmVhbSgpXG4gICAgICAgIGNvbXBvbmVudC5zZXRTdGF0ZSh7XG4gICAgICAgICAgc3RyZWFtOiB7XG4gICAgICAgICAgICB1cmw6ICd0ZXN0JyxcbiAgICAgICAgICAgIHN0cmVhbTogbWVkaWFTdHJlYW0sXG4gICAgICAgICAgICB0eXBlOiBTVFJFQU1fVFlQRV9DQU1FUkEsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSlcbiAgICAgICAgZXhwZWN0KHZpZGVvLnZpZGVvUmVmLmN1cnJlbnQhLnNyYykudG9CZSgnaHR0cDovL2xvY2FsaG9zdC90ZXN0JylcbiAgICAgICAgY29tcG9uZW50LnNldFN0YXRlKHtcbiAgICAgICAgICBzdHJlYW06IHtcbiAgICAgICAgICAgIHVybDogJ3Rlc3QnLFxuICAgICAgICAgICAgc3RyZWFtOiBtZWRpYVN0cmVhbSxcbiAgICAgICAgICAgIHR5cGU6IFNUUkVBTV9UWVBFX0NBTUVSQSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KVxuICAgICAgfSlcbiAgICAgIGl0KCd1cGRhdGVzIHNyY09iamVjdCBvbmx5IHdoZW4gY2hhbmdlZCcsICgpID0+IHtcbiAgICAgICAgdmlkZW8udmlkZW9SZWYuY3VycmVudCEuc3JjT2JqZWN0ID0gbnVsbFxuICAgICAgICBtZWRpYVN0cmVhbSA9IG5ldyBNZWRpYVN0cmVhbSgpXG4gICAgICAgIGNvbXBvbmVudC5zZXRTdGF0ZSh7XG4gICAgICAgICAgc3RyZWFtOiB7XG4gICAgICAgICAgICB1cmw6ICd0ZXN0JyxcbiAgICAgICAgICAgIHN0cmVhbTogbWVkaWFTdHJlYW0sXG4gICAgICAgICAgICB0eXBlOiBTVFJFQU1fVFlQRV9DQU1FUkEsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSlcbiAgICAgICAgZXhwZWN0KHZpZGVvLnZpZGVvUmVmLmN1cnJlbnQhLnNyY09iamVjdCkudG9CZShtZWRpYVN0cmVhbSlcbiAgICAgICAgY29tcG9uZW50LnNldFN0YXRlKHtcbiAgICAgICAgICBzdHJlYW06IHtcbiAgICAgICAgICAgIHVybDogJ3Rlc3QnLFxuICAgICAgICAgICAgc3RyZWFtOiBtZWRpYVN0cmVhbSxcbiAgICAgICAgICAgIHR5cGU6IFNUUkVBTV9UWVBFX0NBTUVSQSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KVxuICAgICAgfSlcbiAgICB9KVxuICB9KVxuXG59KVxuIl19