"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
exports.__esModule = true;
var react_1 = __importDefault(require("react"));
var forEach_1 = __importDefault(require("lodash/forEach"));
var constants_1 = require("../constants");
var nickname_1 = require("../nickname");
var Video_1 = __importDefault(require("./Video"));
var windowStates_1 = require("../reducers/windowStates");
var Videos = /** @class */ (function (_super) {
    __extends(Videos, _super);
    function Videos() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Videos.prototype.getStreams = function () {
        var _a = this.props, windowStates = _a.windowStates, peers = _a.peers, streams = _a.streams;
        var minimized = [];
        var maximized = [];
        function addStreamProps(props) {
            if (props.windowState === 'minimized') {
                minimized.push(props);
            }
            else {
                maximized.push(props);
            }
        }
        function addStreamsByUser(userId) {
            var localUser = userId === constants_1.ME;
            var userStreams = streams[userId];
            if (!userStreams) {
                var key = windowStates_1.getStreamKey(userId, undefined);
                var props = {
                    key: key,
                    userId: userId,
                    localUser: localUser,
                    windowState: windowStates[key]
                };
                addStreamProps(props);
                return;
            }
            userStreams.streams.forEach(function (stream, i) {
                var key = windowStates_1.getStreamKey(userId, stream.stream.id);
                var props = {
                    key: key,
                    stream: stream,
                    userId: userId,
                    mirrored: localUser && stream.type === 'camera',
                    muted: localUser,
                    localUser: localUser,
                    windowState: windowStates[key]
                };
                addStreamProps(props);
            });
        }
        addStreamsByUser(constants_1.ME);
        forEach_1["default"](peers, function (_, userId) { return addStreamsByUser(userId); });
        return { minimized: minimized, maximized: maximized };
    };
    Videos.prototype.render = function () {
        var _this = this;
        var _a = this.getStreams(), minimized = _a.minimized, maximized = _a.maximized;
        var videosToolbar = (react_1["default"].createElement("div", { className: "videos videos-toolbar", key: "videos-toolbar" }, minimized.map(function (props) { return (react_1["default"].createElement(Video_1["default"], __assign({}, props, { key: props.key, onMinimizeToggle: _this.props.onMinimizeToggle, play: _this.props.play, nickname: nickname_1.getNickname(_this.props.nicknames, props.userId), onChangeNickname: _this.props.onChangeNickname }))); })));
        var videosGrid = (react_1["default"].createElement("div", { className: "videos videos-grid", key: "videos-grid" }, maximized.map(function (props) { return (react_1["default"].createElement(Video_1["default"], __assign({}, props, { key: props.key, onMinimizeToggle: _this.props.onMinimizeToggle, play: _this.props.play, nickname: nickname_1.getNickname(_this.props.nicknames, props.userId), onChangeNickname: _this.props.onChangeNickname }))); })));
        return [videosToolbar, videosGrid];
    };
    return Videos;
}(react_1["default"].PureComponent));
exports["default"] = Videos;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVmlkZW9zLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2NsaWVudC9jb21wb25lbnRzL1ZpZGVvcy50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxnREFBeUI7QUFFekIsMkRBQW9DO0FBQ3BDLDBDQUFpQztBQUNqQyx3Q0FBeUM7QUFDekMsa0RBQTJCO0FBRzNCLHlEQUFrRjtBQXVCbEY7SUFBb0MsMEJBQWdDO0lBQXBFOztJQXVGQSxDQUFDO0lBdEZTLDJCQUFVLEdBQWxCO1FBQ1EsSUFBQSxlQUE2QyxFQUEzQyw4QkFBWSxFQUFFLGdCQUFLLEVBQUUsb0JBQXNCLENBQUE7UUFFbkQsSUFBTSxTQUFTLEdBQWtCLEVBQUUsQ0FBQTtRQUNuQyxJQUFNLFNBQVMsR0FBa0IsRUFBRSxDQUFBO1FBRW5DLFNBQVMsY0FBYyxDQUFDLEtBQWtCO1lBQ3hDLElBQUksS0FBSyxDQUFDLFdBQVcsS0FBSyxXQUFXLEVBQUU7Z0JBQ3JDLFNBQVMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUE7YUFDdEI7aUJBQU07Z0JBQ0wsU0FBUyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQTthQUN0QjtRQUNILENBQUM7UUFFRCxTQUFTLGdCQUFnQixDQUFDLE1BQWM7WUFDdEMsSUFBTSxTQUFTLEdBQUcsTUFBTSxLQUFLLGNBQUUsQ0FBQTtZQUUvQixJQUFNLFdBQVcsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUE7WUFFbkMsSUFBSSxDQUFDLFdBQVcsRUFBRTtnQkFDaEIsSUFBTSxHQUFHLEdBQUcsMkJBQVksQ0FBQyxNQUFNLEVBQUUsU0FBUyxDQUFDLENBQUE7Z0JBQzNDLElBQU0sS0FBSyxHQUFnQjtvQkFDekIsR0FBRyxLQUFBO29CQUNILE1BQU0sUUFBQTtvQkFDTixTQUFTLFdBQUE7b0JBQ1QsV0FBVyxFQUFFLFlBQVksQ0FBQyxHQUFHLENBQUM7aUJBQy9CLENBQUE7Z0JBQ0QsY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFBO2dCQUNyQixPQUFNO2FBQ1A7WUFFRCxXQUFXLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxVQUFDLE1BQU0sRUFBRSxDQUFDO2dCQUNwQyxJQUFNLEdBQUcsR0FBRywyQkFBWSxDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFBO2dCQUNsRCxJQUFNLEtBQUssR0FBZ0I7b0JBQ3pCLEdBQUcsS0FBQTtvQkFDSCxNQUFNLEVBQUUsTUFBTTtvQkFDZCxNQUFNLFFBQUE7b0JBQ04sUUFBUSxFQUFFLFNBQVMsSUFBSSxNQUFNLENBQUMsSUFBSSxLQUFLLFFBQVE7b0JBQy9DLEtBQUssRUFBRSxTQUFTO29CQUNoQixTQUFTLFdBQUE7b0JBQ1QsV0FBVyxFQUFFLFlBQVksQ0FBQyxHQUFHLENBQUM7aUJBQy9CLENBQUE7Z0JBQ0QsY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFBO1lBQ3ZCLENBQUMsQ0FBQyxDQUFBO1FBQ0osQ0FBQztRQUVELGdCQUFnQixDQUFDLGNBQUUsQ0FBQyxDQUFBO1FBQ3BCLG9CQUFPLENBQUMsS0FBSyxFQUFFLFVBQUMsQ0FBQyxFQUFFLE1BQU0sSUFBSyxPQUFBLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxFQUF4QixDQUF3QixDQUFDLENBQUE7UUFFdkQsT0FBTyxFQUFFLFNBQVMsV0FBQSxFQUFFLFNBQVMsV0FBQSxFQUFFLENBQUE7SUFDakMsQ0FBQztJQUNELHVCQUFNLEdBQU47UUFBQSxpQkFrQ0M7UUFqQ08sSUFBQSxzQkFBNEMsRUFBMUMsd0JBQVMsRUFBRSx3QkFBK0IsQ0FBQTtRQUVsRCxJQUFNLGFBQWEsR0FBRyxDQUNwQiwwQ0FBSyxTQUFTLEVBQUMsdUJBQXVCLEVBQUMsR0FBRyxFQUFDLGdCQUFnQixJQUN4RCxTQUFTLENBQUMsR0FBRyxDQUFDLFVBQUEsS0FBSyxJQUFJLE9BQUEsQ0FDdEIsaUNBQUMsa0JBQUssZUFDQSxLQUFLLElBQ1QsR0FBRyxFQUFFLEtBQUssQ0FBQyxHQUFHLEVBQ2QsZ0JBQWdCLEVBQUUsS0FBSSxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsRUFDN0MsSUFBSSxFQUFFLEtBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUNyQixRQUFRLEVBQUUsc0JBQVcsQ0FBQyxLQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsRUFBRSxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQ3pELGdCQUFnQixFQUFFLEtBQUksQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLElBQzdDLENBQ0gsRUFUdUIsQ0FTdkIsQ0FBQyxDQUNFLENBQ1AsQ0FBQTtRQUVELElBQU0sVUFBVSxHQUFHLENBQ2pCLDBDQUFLLFNBQVMsRUFBQyxvQkFBb0IsRUFBQyxHQUFHLEVBQUMsYUFBYSxJQUNsRCxTQUFTLENBQUMsR0FBRyxDQUFDLFVBQUEsS0FBSyxJQUFJLE9BQUEsQ0FDdEIsaUNBQUMsa0JBQUssZUFDQSxLQUFLLElBQ1QsR0FBRyxFQUFFLEtBQUssQ0FBQyxHQUFHLEVBQ2QsZ0JBQWdCLEVBQUUsS0FBSSxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsRUFDN0MsSUFBSSxFQUFFLEtBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUNyQixRQUFRLEVBQUUsc0JBQVcsQ0FBQyxLQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsRUFBRSxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQ3pELGdCQUFnQixFQUFFLEtBQUksQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLElBQzdDLENBQ0gsRUFUdUIsQ0FTdkIsQ0FBQyxDQUNFLENBQ1AsQ0FBQTtRQUVELE9BQU8sQ0FBQyxhQUFhLEVBQUUsVUFBVSxDQUFDLENBQUE7SUFDcEMsQ0FBQztJQUNILGFBQUM7QUFBRCxDQUFDLEFBdkZELENBQW9DLGtCQUFLLENBQUMsYUFBYSxHQXVGdEQiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnXG5pbXBvcnQgeyBTdHJlYW1XaXRoVVJMLCBTdHJlYW1zU3RhdGUgfSBmcm9tICcuLi9yZWR1Y2Vycy9zdHJlYW1zJ1xuaW1wb3J0IGZvckVhY2ggZnJvbSAnbG9kYXNoL2ZvckVhY2gnXG5pbXBvcnQgeyBNRSB9IGZyb20gJy4uL2NvbnN0YW50cydcbmltcG9ydCB7IGdldE5pY2tuYW1lIH0gZnJvbSAnLi4vbmlja25hbWUnXG5pbXBvcnQgVmlkZW8gZnJvbSAnLi9WaWRlbydcbmltcG9ydCB7IE5pY2tuYW1lcyB9IGZyb20gJy4uL3JlZHVjZXJzL25pY2tuYW1lcydcbmltcG9ydCB7IE5pY2tuYW1lTWVzc2FnZSB9IGZyb20gJy4uL2FjdGlvbnMvUGVlckFjdGlvbnMnXG5pbXBvcnQgeyBnZXRTdHJlYW1LZXksIFdpbmRvd1N0YXRlcywgV2luZG93U3RhdGUgfSBmcm9tICcuLi9yZWR1Y2Vycy93aW5kb3dTdGF0ZXMnXG5pbXBvcnQgeyBNaW5pbWl6ZVRvZ2dsZVBheWxvYWQgfSBmcm9tICcuLi9hY3Rpb25zL1N0cmVhbUFjdGlvbnMnXG5cbmV4cG9ydCBpbnRlcmZhY2UgVmlkZW9zUHJvcHMge1xuICBvbkNoYW5nZU5pY2tuYW1lOiAobWVzc2FnZTogTmlja25hbWVNZXNzYWdlKSA9PiB2b2lkXG4gIG5pY2tuYW1lczogTmlja25hbWVzXG4gIHBsYXk6ICgpID0+IHZvaWRcbiAgcGVlcnM6IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG4gIHN0cmVhbXM6IFN0cmVhbXNTdGF0ZVxuICBvbk1pbmltaXplVG9nZ2xlOiAocGF5bG9hZDogTWluaW1pemVUb2dnbGVQYXlsb2FkKSA9PiB2b2lkXG4gIHdpbmRvd1N0YXRlczogV2luZG93U3RhdGVzXG59XG5cbmludGVyZmFjZSBTdHJlYW1Qcm9wcyB7XG4gIGtleTogc3RyaW5nXG4gIHN0cmVhbT86IFN0cmVhbVdpdGhVUkxcbiAgdXNlcklkOiBzdHJpbmdcbiAgbXV0ZWQ/OiBib29sZWFuXG4gIGxvY2FsVXNlcj86IGJvb2xlYW5cbiAgbWlycm9yZWQ/OiBib29sZWFuXG4gIHdpbmRvd1N0YXRlOiBXaW5kb3dTdGF0ZVxufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBWaWRlb3MgZXh0ZW5kcyBSZWFjdC5QdXJlQ29tcG9uZW50PFZpZGVvc1Byb3BzPiB7XG4gIHByaXZhdGUgZ2V0U3RyZWFtcygpIHtcbiAgICBjb25zdCB7IHdpbmRvd1N0YXRlcywgcGVlcnMsIHN0cmVhbXMgfSA9IHRoaXMucHJvcHNcblxuICAgIGNvbnN0IG1pbmltaXplZDogU3RyZWFtUHJvcHNbXSA9IFtdXG4gICAgY29uc3QgbWF4aW1pemVkOiBTdHJlYW1Qcm9wc1tdID0gW11cblxuICAgIGZ1bmN0aW9uIGFkZFN0cmVhbVByb3BzKHByb3BzOiBTdHJlYW1Qcm9wcykge1xuICAgICAgaWYgKHByb3BzLndpbmRvd1N0YXRlID09PSAnbWluaW1pemVkJykge1xuICAgICAgICBtaW5pbWl6ZWQucHVzaChwcm9wcylcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG1heGltaXplZC5wdXNoKHByb3BzKVxuICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGFkZFN0cmVhbXNCeVVzZXIodXNlcklkOiBzdHJpbmcpIHtcbiAgICAgIGNvbnN0IGxvY2FsVXNlciA9IHVzZXJJZCA9PT0gTUVcblxuICAgICAgY29uc3QgdXNlclN0cmVhbXMgPSBzdHJlYW1zW3VzZXJJZF1cblxuICAgICAgaWYgKCF1c2VyU3RyZWFtcykge1xuICAgICAgICBjb25zdCBrZXkgPSBnZXRTdHJlYW1LZXkodXNlcklkLCB1bmRlZmluZWQpXG4gICAgICAgIGNvbnN0IHByb3BzOiBTdHJlYW1Qcm9wcyA9IHtcbiAgICAgICAgICBrZXksXG4gICAgICAgICAgdXNlcklkLFxuICAgICAgICAgIGxvY2FsVXNlcixcbiAgICAgICAgICB3aW5kb3dTdGF0ZTogd2luZG93U3RhdGVzW2tleV0sXG4gICAgICAgIH1cbiAgICAgICAgYWRkU3RyZWFtUHJvcHMocHJvcHMpXG4gICAgICAgIHJldHVyblxuICAgICAgfVxuXG4gICAgICB1c2VyU3RyZWFtcy5zdHJlYW1zLmZvckVhY2goKHN0cmVhbSwgaSkgPT4ge1xuICAgICAgICBjb25zdCBrZXkgPSBnZXRTdHJlYW1LZXkodXNlcklkLCBzdHJlYW0uc3RyZWFtLmlkKVxuICAgICAgICBjb25zdCBwcm9wczogU3RyZWFtUHJvcHMgPSB7XG4gICAgICAgICAga2V5LFxuICAgICAgICAgIHN0cmVhbTogc3RyZWFtLFxuICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICBtaXJyb3JlZDogbG9jYWxVc2VyICYmIHN0cmVhbS50eXBlID09PSAnY2FtZXJhJyxcbiAgICAgICAgICBtdXRlZDogbG9jYWxVc2VyLFxuICAgICAgICAgIGxvY2FsVXNlcixcbiAgICAgICAgICB3aW5kb3dTdGF0ZTogd2luZG93U3RhdGVzW2tleV0sXG4gICAgICAgIH1cbiAgICAgICAgYWRkU3RyZWFtUHJvcHMocHJvcHMpXG4gICAgICB9KVxuICAgIH1cblxuICAgIGFkZFN0cmVhbXNCeVVzZXIoTUUpXG4gICAgZm9yRWFjaChwZWVycywgKF8sIHVzZXJJZCkgPT4gYWRkU3RyZWFtc0J5VXNlcih1c2VySWQpKVxuXG4gICAgcmV0dXJuIHsgbWluaW1pemVkLCBtYXhpbWl6ZWQgfVxuICB9XG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IG1pbmltaXplZCwgbWF4aW1pemVkIH0gPSB0aGlzLmdldFN0cmVhbXMoKVxuXG4gICAgY29uc3QgdmlkZW9zVG9vbGJhciA9IChcbiAgICAgIDxkaXYgY2xhc3NOYW1lPVwidmlkZW9zIHZpZGVvcy10b29sYmFyXCIga2V5PVwidmlkZW9zLXRvb2xiYXJcIj5cbiAgICAgICAge21pbmltaXplZC5tYXAocHJvcHMgPT4gKFxuICAgICAgICAgIDxWaWRlb1xuICAgICAgICAgICAgey4uLnByb3BzfVxuICAgICAgICAgICAga2V5PXtwcm9wcy5rZXl9XG4gICAgICAgICAgICBvbk1pbmltaXplVG9nZ2xlPXt0aGlzLnByb3BzLm9uTWluaW1pemVUb2dnbGV9XG4gICAgICAgICAgICBwbGF5PXt0aGlzLnByb3BzLnBsYXl9XG4gICAgICAgICAgICBuaWNrbmFtZT17Z2V0Tmlja25hbWUodGhpcy5wcm9wcy5uaWNrbmFtZXMsIHByb3BzLnVzZXJJZCl9XG4gICAgICAgICAgICBvbkNoYW5nZU5pY2tuYW1lPXt0aGlzLnByb3BzLm9uQ2hhbmdlTmlja25hbWV9XG4gICAgICAgICAgLz5cbiAgICAgICAgKSl9XG4gICAgICA8L2Rpdj5cbiAgICApXG5cbiAgICBjb25zdCB2aWRlb3NHcmlkID0gKFxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJ2aWRlb3MgdmlkZW9zLWdyaWRcIiBrZXk9XCJ2aWRlb3MtZ3JpZFwiPlxuICAgICAgICB7bWF4aW1pemVkLm1hcChwcm9wcyA9PiAoXG4gICAgICAgICAgPFZpZGVvXG4gICAgICAgICAgICB7Li4ucHJvcHN9XG4gICAgICAgICAgICBrZXk9e3Byb3BzLmtleX1cbiAgICAgICAgICAgIG9uTWluaW1pemVUb2dnbGU9e3RoaXMucHJvcHMub25NaW5pbWl6ZVRvZ2dsZX1cbiAgICAgICAgICAgIHBsYXk9e3RoaXMucHJvcHMucGxheX1cbiAgICAgICAgICAgIG5pY2tuYW1lPXtnZXROaWNrbmFtZSh0aGlzLnByb3BzLm5pY2tuYW1lcywgcHJvcHMudXNlcklkKX1cbiAgICAgICAgICAgIG9uQ2hhbmdlTmlja25hbWU9e3RoaXMucHJvcHMub25DaGFuZ2VOaWNrbmFtZX1cbiAgICAgICAgICAvPlxuICAgICAgICApKX1cbiAgICAgIDwvZGl2PlxuICAgIClcblxuICAgIHJldHVybiBbdmlkZW9zVG9vbGJhciwgdmlkZW9zR3JpZF1cbiAgfVxufVxuIl19