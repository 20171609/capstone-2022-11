"use strict";
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    result["default"] = mod;
    return result;
};
exports.__esModule = true;
var config_1 = require("../config");
var turn = __importStar(require("../turn"));
var express_1 = require("express");
var uuid_1 = require("uuid");
var router = express_1.Router();
var BASE_URL = config_1.config.baseUrl;
var cfgIceServers = config_1.config.iceServers;
router.post('/', function (req, res) {
    var callId = req.body.call ? encodeURIComponent(req.body.call) : uuid_1.v4();
    res.redirect(BASE_URL + "/call/" + callId);
});
router.get('/:callId', function (req, res) {
    var iceServers = turn.processServers(cfgIceServers);
    res.render('call', {
        callId: encodeURIComponent(req.params.callId),
        userId: uuid_1.v4(),
        nickname: req.headers['x-forwarded-user'] || '',
        iceServers: iceServers
    });
});
exports["default"] = router;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9zZXJ2ZXIvcm91dGVzL2NhbGwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUEsb0NBQWtDO0FBQ2xDLDRDQUErQjtBQUMvQixtQ0FBZ0M7QUFDaEMsNkJBQXlCO0FBRXpCLElBQU0sTUFBTSxHQUFHLGdCQUFNLEVBQUUsQ0FBQTtBQUV2QixJQUFNLFFBQVEsR0FBVyxlQUFNLENBQUMsT0FBTyxDQUFBO0FBQ3ZDLElBQU0sYUFBYSxHQUFHLGVBQU0sQ0FBQyxVQUFVLENBQUE7QUFFdkMsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsVUFBQyxHQUFHLEVBQUUsR0FBRztJQUN4QixJQUFNLE1BQU0sR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsa0JBQWtCLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBRSxFQUFFLENBQUE7SUFDdkUsR0FBRyxDQUFDLFFBQVEsQ0FBSSxRQUFRLGNBQVMsTUFBUSxDQUFDLENBQUE7QUFDNUMsQ0FBQyxDQUFDLENBQUE7QUFFRixNQUFNLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRSxVQUFDLEdBQUcsRUFBRSxHQUFHO0lBQzlCLElBQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsYUFBYSxDQUFDLENBQUE7SUFDckQsR0FBRyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUU7UUFDakIsTUFBTSxFQUFFLGtCQUFrQixDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDO1FBQzdDLE1BQU0sRUFBRSxTQUFFLEVBQUU7UUFDWixRQUFRLEVBQUUsR0FBRyxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLEVBQUU7UUFDL0MsVUFBVSxZQUFBO0tBQ1gsQ0FBQyxDQUFBO0FBQ0osQ0FBQyxDQUFDLENBQUE7QUFFRixxQkFBZSxNQUFNLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjb25maWcgfSBmcm9tICcuLi9jb25maWcnXG5pbXBvcnQgKiBhcyB0dXJuIGZyb20gJy4uL3R1cm4nXG5pbXBvcnQgeyBSb3V0ZXIgfSBmcm9tICdleHByZXNzJ1xuaW1wb3J0IHsgdjQgfSBmcm9tICd1dWlkJ1xuXG5jb25zdCByb3V0ZXIgPSBSb3V0ZXIoKVxuXG5jb25zdCBCQVNFX1VSTDogc3RyaW5nID0gY29uZmlnLmJhc2VVcmxcbmNvbnN0IGNmZ0ljZVNlcnZlcnMgPSBjb25maWcuaWNlU2VydmVyc1xuXG5yb3V0ZXIucG9zdCgnLycsIChyZXEsIHJlcykgPT4ge1xuICBjb25zdCBjYWxsSWQgPSByZXEuYm9keS5jYWxsID8gZW5jb2RlVVJJQ29tcG9uZW50KHJlcS5ib2R5LmNhbGwpIDogdjQoKVxuICByZXMucmVkaXJlY3QoYCR7QkFTRV9VUkx9L2NhbGwvJHtjYWxsSWR9YClcbn0pXG5cbnJvdXRlci5nZXQoJy86Y2FsbElkJywgKHJlcSwgcmVzKSA9PiB7XG4gIGNvbnN0IGljZVNlcnZlcnMgPSB0dXJuLnByb2Nlc3NTZXJ2ZXJzKGNmZ0ljZVNlcnZlcnMpXG4gIHJlcy5yZW5kZXIoJ2NhbGwnLCB7XG4gICAgY2FsbElkOiBlbmNvZGVVUklDb21wb25lbnQocmVxLnBhcmFtcy5jYWxsSWQpLFxuICAgIHVzZXJJZDogdjQoKSxcbiAgICBuaWNrbmFtZTogcmVxLmhlYWRlcnNbJ3gtZm9yd2FyZGVkLXVzZXInXSB8fCAnJyxcbiAgICBpY2VTZXJ2ZXJzLFxuICB9KVxufSlcblxuZXhwb3J0IGRlZmF1bHQgcm91dGVyXG4iXX0=